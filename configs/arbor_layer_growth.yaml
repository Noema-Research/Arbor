# Arbor Layer Growth - Adaptive depth scaling configuration
# Demonstrates dynamic layer growth from 24 to 64 layers

model:
  vocab_size: 10000
  dim: 512
  num_layers: 24  # Starting number of layers
  num_heads: 8
  ffn_dim: 2048
  max_seq_length: 1024
  dropout: 0.1
  attention_dropout: 0.1
  ffn_dropout: 0.1
  layer_norm_eps: 1e-5
  activation: "gelu"
  causal: true
  tie_word_embeddings: true

# Dataset configuration
data:
  type: "synthetic"
  vocab_size: 10000
  seq_length: 1024
  num_sequences: 100000  # Larger dataset for growth testing
  batch_size: 16  # Smaller batch to force more intensive layer usage
  val_split: 0.1
  test_split: 0.05

# Training configuration
training:
  max_steps: 50000  # Longer training to see growth
  learning_rate: 1e-4
  weight_decay: 0.01
  optimizer: "adamw"
  betas: [0.9, 0.95]
  eps: 1e-8
  
  # Mixed precision and efficiency
  use_amp: true
  gradient_accumulation_steps: 4
  max_grad_norm: 1.0
  
  # Scheduling
  use_scheduler: true
  warmup_steps: 2000
  
  # Logging and checkpointing
  log_every: 100
  eval_every: 1000
  save_every: 2000

# Growth configuration (enabled with layer growth)
growth:
  enabled: true
  add_hidden: 256
  max_events: 6
  cooldown_steps: 2000
  layer_selection: "uniform"
  layers_per_event: 2
  new_param_lr_multiplier: 0.5
  
  # Layer growth configuration - ENABLED
  layer_growth_enabled: true
  min_layers: 24
  max_layers: 64
  layer_growth_threshold: 0.92  # Trigger when 92% of capacity used
  layer_growth_factor: 4  # Add 4 layers at a time
  layer_growth_cooldown: 5000  # Wait 5000 steps between layer additions
  
  triggers:
    - type: "plateau"
      window_steps: 1000
      eps: 0.001
    - type: "gradnorm"
      threshold: 1e-3
      window_steps: 500

# Infrastructure
infrastructure:
  device: "auto"
  num_workers: 4
  pin_memory: true
  
# Distributed training (optional)
distributed:
  enabled: false
  backend: "nccl"
  world_size: 1
  
# Logging
logging:
  log_level: "INFO"
  use_wandb: true
  wandb_project: "arbor-o1-layer-growth"
  checkpoint_dir: "checkpoints/layer_growth"
  
# Experiment tracking
experiment:
  name: "arbor_layer_growth_demo"
  tags: ["development", "layer-growth", "adaptive-depth", "24-64-layers"]
  notes: "Demonstration of dynamic layer growth scaling from 24 to 64 layers based on utilization"
