# Arbor Growth - Growth-enabled configuration
# Demonstrates dynamic model expansion during training

model:
  vocab_size: 10000
  dim: 512
  num_layers: 8
  num_heads: 8
  ffn_dim: 1536  # Start smaller to show growth
  max_seq_length: 1024
  dropout: 0.1
  attention_dropout: 0.1
  ffn_dropout: 0.1
  layer_norm_eps: 1e-5
  activation: "gelu"
  causal: true
  tie_word_embeddings: true

# Dataset configuration
data:
  type: "synthetic"
  vocab_size: 10000
  seq_length: 1024
  num_sequences: 50000
  batch_size: 32
  val_split: 0.1
  test_split: 0.05

# Training configuration
training:
  max_steps: 25000
  learning_rate: 1e-4
  weight_decay: 0.01
  optimizer: "adamw"
  betas: [0.9, 0.95]
  eps: 1e-8
  
  # Mixed precision and efficiency
  use_amp: true
  gradient_accumulation_steps: 4
  max_grad_norm: 1.0
  
  # Scheduling
  use_scheduler: true
  warmup_steps: 2000
  
  # Logging and checkpointing
  log_every: 100
  eval_every: 500
  save_every: 1000

# Growth configuration (ENABLED)
growth:
  enabled: true
  add_hidden: 256
  max_events: 6
  cooldown_steps: 2000
  layer_selection: "uniform"  # "uniform", "top_k", "bottom_k", "middle"
  layers_per_event: 2
  new_param_lr_multiplier: 0.5  # Lower LR for new parameters
  
  # Multiple triggers for comprehensive growth detection
  triggers:
    # Plateau trigger - fires when validation loss plateaus
    - type: "plateau"
      window_steps: 1000
      eps: 0.001
      
    # Gradient norm trigger - fires when gradients become too small
    - type: "gradnorm"
      threshold: 5e-4
      window_steps: 500
      
    # Loss spike trigger - fires when certain data slices show higher loss
    - type: "loss_spike"
      slice_type: "random"
      probability: 0.1
      ratio_threshold: 1.5
      window_steps: 200
      min_samples: 30

# Infrastructure
infrastructure:
  device: "auto"
  num_workers: 4
  pin_memory: true
  
# Distributed training (optional)
distributed:
  enabled: false
  backend: "nccl"
  world_size: 1
  
# Logging
logging:
  log_level: "INFO"
  use_wandb: true
  wandb_project: "arbor-o1-growth"
  checkpoint_dir: "checkpoints"
  
# Experiment tracking
experiment:
  name: "arbor_growth_demo"
  tags: ["growth", "dynamic", "demo"]
  notes: "Growth-enabled model demonstrating dynamic capacity expansion"
  
# Advanced settings
advanced:
  # Warmup new parameters after growth
  warmup_new_params: true
  warmup_steps: 100
  warmup_lr: 1e-5
  
  # Growth analysis
  save_growth_plots: true
  track_layer_utilization: true
  
  # Memory management
  cleanup_old_checkpoints: true
  keep_last_n_checkpoints: 3
